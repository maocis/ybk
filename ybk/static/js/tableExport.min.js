(function(d){d.fn.extend({tableExport:function(k){function n(l,g,b,e){d(l).filter(":visible").find(g).each(function(l,g){"none"!=d(this).css("display")&&"none"!=d(this).data("tableexport-display")&&-1==a.ignoreColumn.indexOf(l)&&"function"===typeof e&&e(this,b,l)})}function x(l){!0===a.consoleLog&&console.log(l.output());if("string"==a.outputMode)return l.output();if("base64"==a.outputMode)return r(l.output());try{var g=l.output("blob");saveAs(g,a.fileName+".pdf")}catch(b){t(a.fileName+".pdf","data:application/pdf;base64,"+
r(l.output()))}}function y(l,g,b){var e="";g=p(l,g,b);l=null===g||""==g?"":g.toString();if(g instanceof Date)e=a.csvEnclosure+g.toLocaleString()+a.csvEnclosure;else if(g=a.csvEnclosure+a.csvEnclosure,e=l.replace(new RegExp(a.csvEnclosure.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),g),0<=e.indexOf(a.csvSeparator)||/[\r\n ]/g.test(e))e=a.csvEnclosure+e+a.csvEnclosure;return e}function p(l,g,b){l=d(l);content_data=!0===a.htmlContent?l.html().trim():l.text().trim().replace(/\u00AD/g,"");!0===a.escape&&
(content_data=escape(content_data));"function"===typeof a.onCellData&&(content_data=a.onCellData(l,g,b,content_data));return content_data}function F(a,g,b){return g+"-"+b.toLowerCase()}function z(a,g,b){window.getComputedStyle?(g=g.replace(/([a-z])([A-Z])/,F),g=window.getComputedStyle(a,null).getPropertyValue(g)):g=a.currentStyle?a.currentStyle[g]:a.style[g];g=g.match(/\d+/);if(null!==g){g=g[0];var e=document.createElement("div");e.style.overflow="hidden";e.style.visibility="hidden";a.parentElement.appendChild(e);
e.style.width=100+b;b=100/e.offsetWidth;a.parentElement.removeChild(e);return g*b}return 0}function t(a,b){var c=document.createElement("a");if(c){document.body.appendChild(c);c.style="display: none";c.download=a;c.href=b;if(document.createEvent)null==u&&(u=document.createEvent("MouseEvents")),u.initEvent("click",!0,!1),c.dispatchEvent(u);else if(document.createEventObject)c.fireEvent("onclick");else if("function"==typeof c.onclick)c.onclick();document.body.removeChild(c)}}function r(a){var b="",
c,e,d,f,h,k,m=0;a=a.replace(/\x0d\x0a/g,"\n");e="";for(d=0;d<a.length;d++)f=a.charCodeAt(d),128>f?e+=String.fromCharCode(f):(127<f&&2048>f?e+=String.fromCharCode(f>>6|192):(e+=String.fromCharCode(f>>12|224),e+=String.fromCharCode(f>>6&63|128)),e+=String.fromCharCode(f&63|128));for(a=e;m<a.length;)c=a.charCodeAt(m++),e=a.charCodeAt(m++),d=a.charCodeAt(m++),f=c>>2,c=(c&3)<<4|e>>4,h=(e&15)<<2|d>>6,k=d&63,isNaN(e)?h=k=64:isNaN(d)&&(k=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k);return b}var a={csvSeparator:",",csvEnclosure:'"',onCellData:null,ignoreColumn:[],displayTableName:!1,theadSelector:"tr",tbodySelector:"tr",tableName:"myTableName",worksheetName:"xlsWorksheetName",type:"csv",jspdf:{orientation:"p",unit:"pt",format:"a4",margins:{left:20,
right:10,top:10,bottom:10},autotable:{padding:2,lineHeight:12,fontSize:8}},escape:!1,htmlContent:!1,consoleLog:!1,outputMode:"file",fileName:"tableExport",excelstyles:["border-bottom","border-top","border-left","border-right"]};k=d.extend(!0,a,k);var u=null;if("csv"==a.type||"txt"==a.type){var c="",h=0;d(this).find("thead").find(a.theadSelector).each(function(){c+="\n";n(this,"th,td",h,function(b,g,d){c+=y(b,g,d)+a.csvSeparator});h++;c=d.trim(c);c=d.trim(c).substring(0,c.length-1)});d(this).find("tbody").find(a.tbodySelector).each(function(){trData=
"";n(this,"td",h,function(b,c,d){trData+=y(b,c,d)+a.csvSeparator});trData.length>a.csvSeparator.length&&(c+="\n"+trData);h++;c=d.trim(c).substring(0,c.length-1)});c+="\n";!0===a.consoleLog&&console.log(c);if("string"==a.outputMode)return c;if("base64"==a.outputMode)return r(c);try{var q=new Blob([("csv"==a.type?"\ufeff":"")+c],{type:"text/"+("csv"==a.type?"csv":"plain")+";charset=utf-8"});saveAs(q,a.fileName+"."+a.type)}catch(G){t(a.fileName+"."+a.type,"data:text/"+("csv"==a.type?"csv":"plain")+";charset=utf-8,"+
("csv"==a.type?"\ufeff":"")+encodeURIComponent(c))}}else if("sql"==a.type){h=0;c="INSERT INTO `"+a.tableName+"` (";d(this).find("thead").find(a.theadSelector).each(function(){n(this,"th,td",h,function(a,b,d){c+="'"+p(a,b,d)+"',"});h++;c=d.trim(c);c=d.trim(c).substring(0,c.length-1)});c+=") VALUES ";d(this).find("tbody").find(a.tbodySelector).each(function(){trData="";n(this,"td",h,function(a,b,c){trData+="'"+p(a,b,c)+"',"});3<trData.length&&(c+="("+trData,c=d.trim(c).substring(0,c.length-1),c+="),");
h++});c=d.trim(c).substring(0,c.length-1);c+=";";!0===a.consoleLog&&console.log(c);if("string"==a.outputMode)return c;if("base64"==a.outputMode)return r(c);try{q=new Blob([c],{type:"text/plain;charset=utf-8"}),saveAs(q,a.fileName+".sql")}catch(H){t(a.fileName+".sql","data:application/sql;charset=utf-8,"+encodeURIComponent(c))}}else if("json"==a.type){var A=[];d(this).find("thead").find(a.theadSelector).each(function(){var a=[],b=0;n(this,"th,td",b,function(b,c,g){a.push(p(b,c,g))});b++;A.push(a)});
var B=[];d(this).find("tbody").find(a.tbodySelector).each(function(){var a=[];n(this,"td",h,function(b,c,e){a.push(p(b,c,e))});0<a.length&&(1!=a.length||""!=a[0])&&B.push(a);h++});k=[];k.push({header:A,data:B});var b=JSON.stringify(k);!0===a.consoleLog&&console.log(b);if("string"==a.outputMode)return b;k=r(b);if("base64"==a.outputMode)return k;try{q=new Blob([b],{type:"application/json;charset=utf-8"}),saveAs(q,a.fileName+".json")}catch(I){t(a.fileName+".json","data:application/json;charset=utf-8;base64,"+
k)}}else if("xml"==a.type){var h=0,m='<?xml version="1.0" encoding="utf-8"?>',m=m+"<tabledata><fields>";d(this).find("thead").find(a.theadSelector).each(function(){n(this,"th,td",h,function(a,b,c){m+="<field>"+p(a,b,c)+"</field>"});h++});var m=m+"</fields><data>",v=1;d(this).find("tbody").find(a.tbodySelector).each(function(){var a=1,b="";n(this,"td",h,function(c,e,d){b+="<column-"+a+">"+p(c,e,d)+"</column-"+a+">";a++});"<column-1></column-1>"!=b&&(m+='<row id="'+v+'">'+b+"</row>",v++);h++});m+="</data></tabledata>";
!0===a.consoleLog&&console.log(m);if("string"==a.outputMode)return m;k=r(m);if("base64"==a.outputMode)return k;try{q=new Blob([m],{type:"application/xml;charset=utf-8"}),saveAs(q,a.fileName+".xml")}catch(J){t(a.fileName+".xml","data:application/xml;charset=utf-8;base64,"+k)}}else if("excel"==a.type||"doc"==a.type){var h=0,f="<table>";d(this).find("thead").find(a.theadSelector).each(function(){f+="<tr>";n(this,"th,td",h,function(b,c,h){f+="<td style='";for(var e in a.excelstyles)a.excelstyles.hasOwnProperty(e)&&
(f+=a.excelstyles[e]+": "+d(b).css(a.excelstyles[e])+";");f+="'>"+p(b,c,h)+"</td>"});h++;f+="</tr>"});v=1;d(this).find("tbody").find(a.tbodySelector).each(function(){f+="<tr>";n(this,"td",h,function(b,c,h){f+="<td style='";for(var e in a.excelstyles)a.excelstyles.hasOwnProperty(e)&&(f+=a.excelstyles[e]+": "+d(b).css(a.excelstyles[e])+";");d(b).is("[colspan]")&&(f+="' colspan='"+d(b).attr("colspan"));f+="'>"+p(b,c,h)+"</td>"});v++;h++;f+="</tr>"});a.displayTableName&&(f+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+
p(d("<p>"+a.tableName+"</p>"))+"</td></tr>");f+="</table>";!0===a.consoleLog&&console.log(f);b="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:"+a.type+"' xmlns='http://www.w3.org/TR/REC-html40'>";b+='<meta http-equiv="content-type" content="application/vnd.ms-'+a.type+'; charset=UTF-8">';b=b+'<meta http-equiv="content-type" content="application/'+("excel"==a.type?"vnd.ms-excel":"msword");b+='; charset=UTF-8">';b+="<head>";"excel"==a.type&&(b+="\x3c!--[if gte mso 9]>",
b+="<xml>",b+="<x:ExcelWorkbook>",b+="<x:ExcelWorksheets>",b+="<x:ExcelWorksheet>",b+="<x:Name>",b+=a.worksheetName,b+="</x:Name>",b+="<x:WorksheetOptions>",b+="<x:DisplayGridlines/>",b+="</x:WorksheetOptions>",b+="</x:ExcelWorksheet>",b+="</x:ExcelWorksheets>",b+="</x:ExcelWorkbook>",b+="</xml>",b+="<![endif]--\x3e");b+="</head>";b+="<body>";b+=f;b+="</body>";b+="</html>";if("string"==a.outputMode)return b;k=r(b);if("base64"==a.outputMode)return k;var C="excel"==a.type?"xls":"doc";try{q=new Blob([b],
{type:"application/vnd.ms-"+a.type}),saveAs(q,a.fileName+"."+C)}catch(K){t(a.fileName+"."+C,"data:application/vnd.ms-"+a.type+";base64,"+k)}}else if("png"==a.type)html2canvas(d(this),{onrendered:function(b){b=b.toDataURL();b=b.substring(22);for(var c=atob(b),d=new ArrayBuffer(c.length),e=new Uint8Array(d),f=0;f<c.length;f++)e[f]=c.charCodeAt(f);try{var h=new Blob([d],{type:"image/png"});saveAs(h,a.fileName+".png")}catch(k){t(a.fileName+".png","data:image/png;base64,"+b)}}});else if("pdf"==a.type){var w=
new jsPDF(a.jspdf.orientation,a.jspdf.unit,a.jspdf.format);if(!1===a.jspdf.autotable)k={dim:{w:z(d(this).get(0),"width","mm"),h:z(d(this).get(0),"height","mm")}},w.addHTML(d(this),a.jspdf.margins.left,a.jspdf.margins.top,k,function(){x(w)});else{var D=[];d(this).find("thead").find(a.theadSelector).each(function(){var a=0;n(this,"th,td",a,function(a,b,c){D.push(p(a,b,c))});a++});var E=[];d(this).find("tbody").find(a.tbodySelector).each(function(){var a=[];n(this,"td",h,function(b,c,d){a.push(p(b,c,
d))});h++;E.push(a)});a.jspdf.autotable.margins={};d.extend(!0,a.jspdf.autotable.margins,a.jspdf.margins);w.autoTable(D,E,a.jspdf.autotable);x(w)}}}})})(jQuery);
